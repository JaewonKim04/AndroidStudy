# 런타임 권한
- Android 6(API 레벨 23) 부터 위험 권한을 명시적으로 요청해야함
- 사용자가 필요할 때만 권한을 부여하도록 허용
## 권한 허용 확인, 요청
1. 권한 선언 및 확인
- AndroidManifest 파일에 필요한 권한을 선언해야 함
```xml
    <uses-permission android:name="android.permission.INTERNET" />
    <uses-permission android:name="android.permission.CAMERA" />
```
- 권한이 이미 허용되었는지 확인, 허용하지 않았다면 권한 요청
```kotlin
ContextCompat.checkSelfPermission(this, Manifest.permission.CAMERA) == PackageManager.PERMISSION_GRANTED // 권한 허용했는지 여부
```
2. 권한 요청
- ActivityResultLauncher API 사용을 권장
```kotlin
val requestPermissionLauncher = registerForActivityResult(ActivityResultContracts.RequestPermission()) { isGranted ->
    if (isGranted) {
        println("Permission granted")
    } else {
        println("Permission denied")
    }
}
```
- 사용자에게 다이얼로그 표시, 사용자는 동의 혹은 거절할 수. 있음
- 경우에 따라 시스템은 권한을 요청하기 전 필요한 이유를 표시하도록 권장함
   - `shouldShowRequestPermissionRationale() == true` 인 경우 : 사용자가 이미 요청을 거부한 경우
3. 권한 거부 처리하기
- 권한을 여러번 거부 당하면 안드로이드는 이를 영구 거부로 처리
- 이 경우에 권한이 필요하다면 기능 제한에 대해 알리고 시스템 설정으로 안내해야 함
```kotlin
        if (!ActivityCompat.shouldShowRequestPermissionRationale(
                this,
                Manifest.permission.CAMERA
            ) && ContextCompat.checkSelfPermission(
                this,
                Manifest.permission.CAMERA
            ) != PackageManager.PERMISSION_GRANTED
        ) {
            val intent = Intent(Settings.ACTION_APPLICATION_SETTINGS).apply {
                data = Uri.parse("package:$packageName") // 시스템 설정으로 이동
            }
            startActivity(intent)
        }
```
## 위치 권한 처리하기
- 포그라운드 / 백그라운드 위치 권한 존재
```xml
<uses-permission android:name="android.permission.ACCESS_FINE_LOCATION" /> // 포그라운드 권한
<uses-permission android:name="android.permission.ACCESS_BACKGROUND_LOCATION" /> // 백그라운드 권한(포그라운드 권한에 추가)
```
- 안드로이드 10 부터 백그라운드 위치를 요청하는 앱은 포그라운드 위치 접근 권한을 먼저 요청해야함
## 일회성 권한
- 안드로이드 11 부터 도임
- 위치, 카메라, 마이크에 대해 일회성 권한 도입
- 앱이 종료되면 해당 권한은 사라짐