# R8 최적화
- APK 또는 AAB를 최적화하는 도구
    - 코드 축소, 최적화, 난독화 및 리소스 관리
- 프로가드 도구를 대체
## 작동 방식 & 특징
- 코드 축소 : 코드베이스에서 사용하지 않는 코드 (클래스, 메서드, 필드 및 속성) 제거
- 최적화 : 메서드 인라이닝, 중복 코드 제거, 동일한 코드 블록 병합
    - 메서드 인라이닝
    ```kotlin
    fun methodA() {
        print("${methodB()}")
    }
    fun methodB() = "Result"

    메서드 인라이닝-->

    fun methodA(){
        print("${"Result"})
    }
    ```
- 난독화 : 클래스, 메서드 및 필드명을 모호하게 변경, 리버스 엔지니어링을 어렵게 만듦
- 리소스 최적화 : 사용하지 않는 리소스(드로어블 등) 제거 
- 클래스 병합 : 유사한 클래스나 인터페이스를 하나로 결합
- 상수 폴딩 및 전파 : 표현식을 단순화, 변수를 가능한 경우 해당 상수로 대체
```kotlin
fun calculateValue(): Int {
    val BASE_VALUE = 20
    val OFFSET = 5
    
    val intermediate1 = BASE_VALUE * 3 // 상수 연산 1
    val intermediate2 = intermediate1 + OFFSET // 상수 연산 2
    
    val finalValue = intermediate2 / 5 // 상수 연산 3
    
    return finalValue + 1
}

상수 폴딩 ->

fun calculateValue(): Int {
    val BASE_VALUE = 20
    val OFFSET = 5
    
    val intermediate1 = 60 // 폴딩 결과
    val intermediate2 = intermediate1 + OFFSET
    
    val finalValue = intermediate2 / 5
    
    return finalValue + 1
}

전파 ->

fun calculateValue(): Int {
    val BASE_VALUE = 20
    val OFFSET = 5
    
    val intermediate1 = 60
    val intermediate2 = 60 + 5 // 전파된 상수
    
    val finalValue = intermediate2 / 5
    
    return finalValue + 1
}

반복 -> 

fun calculateValue(): Int {
    return 14 // 모든 계산이 컴파일 타임에 완료됨
}
```

- 코드 크기를 줄이고 연산 횟수를 줄임

## 난독화 제외
- 리플렉션이 가능한 코드, 또는 그러한 코드가 포함되어 있을 수. 있는 서드파티 라이브러리는 명시적으로 제외 필요

## 한계
- 런타임 오류 유발 : 간접적으로 참조되는 코드나 리소스를 제거할 수 있음
- 복잡한 구성 : 리플렉션이나 동적 클래스 로딩을 사용하는 프로젝트의 경우 ProGuard 규칙 작성이 복잡하고 까다로울 수 있음
- 디버깅 어려움 : 스택 트레이스에 난독화된 이름이 로깅되기 때문에 디버깅을 더 어렵게 만들 수 있음